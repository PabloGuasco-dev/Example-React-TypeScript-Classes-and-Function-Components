{"ast":null,"code":"class RuledCheckout {\n  constructor(pricingRules) {\n    this.foundArticle = false;\n    this.items = void 0;\n    this.pricingRules = void 0;\n    this.items = {};\n    this.pricingRules = pricingRules;\n    return this;\n  }\n\n  scan(code) {\n    if (this.items[code]) {\n      this.items[code]++;\n    } else {\n      if (!this.pricingRules[code]) {\n        throw new Error(`Cannot scan item: no pricing rule for code \"${code}\"`);\n      }\n\n      this.items[code] = 1;\n    }\n\n    this.foundArticle = true;\n    return this;\n  }\n\n  total() {\n    const totalReducer = function (sum, _ref) {\n      let [code, qty] = _ref;\n      const applyRules = this.pricingRules[code];\n      const itemSubtotal = applyRules(qty);\n      return sum + itemSubtotal;\n    };\n\n    return Object.entries(this.items).reduce(totalReducer.bind(this), 0);\n  }\n\n}\n\nexport { RuledCheckout };","map":{"version":3,"names":["RuledCheckout","constructor","pricingRules","foundArticle","items","scan","code","Error","total","totalReducer","sum","qty","applyRules","itemSubtotal","Object","entries","reduce","bind"],"sources":["/Users/pguasco/Projects/challenge-cabify/src/entities/checkout.ts"],"sourcesContent":["import type Checkout from './ICheckout';\n\ntype Code = string & ('TSHIRT' | 'MUG' | 'CAP');\n\ntype Quantity = number;\n\ntype Items = Record<Code, Quantity>;\n\ntype PricingRules = Record<Code, (quantity: Quantity) => number>;\n\ntype TotalReducer = (sum: number, item: Array<Code | Quantity>) => number;\n\nclass RuledCheckout implements Checkout {\n  \n  foundArticle: boolean = false;\n\n  private items: Items;\n\n  private pricingRules: PricingRules;\n\n  constructor(pricingRules: PricingRules) {\n    this.items = {} as Items;\n    this.pricingRules = pricingRules;\n    return this;\n  }\n\n  scan(code: string) {\n    if (this.items[code as Code]) {\n      this.items[code as Code]++;\n    } else {\n      if (!this.pricingRules[code as Code]) {\n        throw new Error(`Cannot scan item: no pricing rule for code \"${code}\"`);\n      }\n\n      this.items[code as Code] = 1;\n    }\n    this.foundArticle = true;\n    return this;\n  }\n\n  total() {\n    const totalReducer: TotalReducer = function(sum, [code, qty]) {\n      const applyRules = this.pricingRules[code]\n      const itemSubtotal = applyRules(qty);\n      return sum + itemSubtotal;\n    };\n\n    return Object\n      .entries(this.items)\n      .reduce(totalReducer.bind(this), 0) as number;\n  }\n}\n\nexport { RuledCheckout };"],"mappings":"AAYA,MAAMA,aAAN,CAAwC;EAQtCC,WAAW,CAACC,YAAD,EAA6B;IAAA,KANxCC,YAMwC,GANhB,KAMgB;IAAA,KAJhCC,KAIgC;IAAA,KAFhCF,YAEgC;IACtC,KAAKE,KAAL,GAAa,EAAb;IACA,KAAKF,YAAL,GAAoBA,YAApB;IACA,OAAO,IAAP;EACD;;EAEDG,IAAI,CAACC,IAAD,EAAe;IACjB,IAAI,KAAKF,KAAL,CAAWE,IAAX,CAAJ,EAA8B;MAC5B,KAAKF,KAAL,CAAWE,IAAX;IACD,CAFD,MAEO;MACL,IAAI,CAAC,KAAKJ,YAAL,CAAkBI,IAAlB,CAAL,EAAsC;QACpC,MAAM,IAAIC,KAAJ,CAAW,+CAA8CD,IAAK,GAA9D,CAAN;MACD;;MAED,KAAKF,KAAL,CAAWE,IAAX,IAA2B,CAA3B;IACD;;IACD,KAAKH,YAAL,GAAoB,IAApB;IACA,OAAO,IAAP;EACD;;EAEDK,KAAK,GAAG;IACN,MAAMC,YAA0B,GAAG,UAASC,GAAT,QAA2B;MAAA,IAAb,CAACJ,IAAD,EAAOK,GAAP,CAAa;MAC5D,MAAMC,UAAU,GAAG,KAAKV,YAAL,CAAkBI,IAAlB,CAAnB;MACA,MAAMO,YAAY,GAAGD,UAAU,CAACD,GAAD,CAA/B;MACA,OAAOD,GAAG,GAAGG,YAAb;IACD,CAJD;;IAMA,OAAOC,MAAM,CACVC,OADI,CACI,KAAKX,KADT,EAEJY,MAFI,CAEGP,YAAY,CAACQ,IAAb,CAAkB,IAAlB,CAFH,EAE4B,CAF5B,CAAP;EAGD;;AAtCqC;;AAyCxC,SAASjB,aAAT"},"metadata":{},"sourceType":"module"}